
@{
    ViewBag.Title = "SQL Manager";
}
<link href="~/Assets/codemirror/codemirror.css" rel="stylesheet" />

<div class="ibox sql" ng-controller="SqlController"    infinite-scroll='LoadMoreData()' infinite-scroll-distance='2' ng-cloak>
    <div contextmenu="company.contextmenu" class="dropdown contextmenu">
        <ul class="dropdown-menu" role="menu">
            <li>
                <a href="javascript:void(0);"
                   ng-click="AddNew()"
                   ng-if="CanAddRow()">
                    <i class="fa fa-plus"></i>  Add New
                </a>
            </li>
            <li>
                <a role="menuitem" tabindex="-1" href ng-click="AppServices.Common.CopySelectionToClipboard()">
                    <i class="fa fa-copy"></i>  Copy
                </a>
            </li>
            <li class="divider"></li>
            <li class="dropdown dropdown-submenu">
                <a role="menu" tabindex="-1" href>
                    <i class="fa fa-long-arrow-right"></i> Export
                </a>
                <ul class="dropdown-menu" role="menu">
                    <li>
                        <a role="menu" tabindex="-1" href ng-click="ExportToCsv('QueryData')">
                            <i class="fa fa-file-excel-o"></i> Export To Csv
                        </a>
                    </li>
                    <li>
                        <a role="menu" tabindex="-1" href ng-click="ExportToTxt('QueryData')">
                            <i class="fa fa-file-text"></i> Export To Txt
                        </a>
                    </li>
                </ul>
            </li>
        </ul>
    </div>
    <form class="form-horizontal" role="form" id="sqlForm" name="sqlForm">
        <div class="ibox-content">
            <div class="toolbar clearfix">
                <div class="form-group form-inline">
                    <div class="input-group col-sm-7 col-md-5 col-lg-3">
                        <div class="input-group-addon">Database: </div>
                        <input type="text"
                               disabled="disabled"
                               class="form-control input-sm"
                               id="databaseName"
                               ng-model="Database"
                               placeholder="DB_9BB9A7_prestige_admin">
                        <div class="input-group-btn">
                            <button type="button" class="btn btn-sm btn-primary" ng-click="RunSql()" uib-tooltip="Run -F5" tooltip>
                                <i class="fa fa-exclamation"></i> Run
                            </button>
                        </div>
                    </div>
                    <div class="btn-group">
                        <button type="button" class="btn btn-sm btn-white" ng-click="OpenFile()" uib-tooltip="Pick File">
                            <i class="fa fa-folder-open"></i> Open
                        </button>
                    </div>
                </div>
            </div>
            <div class="code-content" style="width: 100%" shortcut="116" shortcut-key="F5" shortcut-Handler="RunSql()">
                @*<textarea class="code" 
                          ui-codemirror="cmOption"
                          ng-model="Sql" id="syntaxEditor"></textarea>*@
                
                <div ui-codemirror ng-model="Sql" id="syntaxEditor" ui-codemirror-opts="cmOption"></div>
            </div>
            
            <div class="tabs-container  mt10">
                <ul class="nav nav-tabs">
                    <li class="active">
                        <a data-toggle="tab" href="#tab-results">
                            Results
                        </a>
                    </li>
                </ul>
                <div class="tab-content">
                    <div id="tab-results" class="tab-pane active">
                        <div class="panel-body">
                            <div class="color-red mess" ng-show="Succeeded==false">
                                {{Message}}
                            </div>
                                <div class="table-scrollable clearfix" ng-show="Succeeded==true">
                                    <table st-table="VisibleRows"
                                           contextmenu-container="company.contextmenu"
                                           class="table table-striped table-bordered table-advance table-hover">
                                        <thead>
                                        <tr>
                                            <th ng-repeat="col in Columns">{{col}}</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr tabindex="0"
                                            ng-esc="CancelEditRow(row)"
                                            ng-focus="OnRowClicked(row)"
                                            @*ng-blur="OnRowClicked(row)"*@
                                            ng-dblclick="BeginEditRow(row)"
                                            @*ng-click="OnRowClicked(row)"*@
                                            contextmenu-item="row"
                                            ng-class="{'editing':row.Editing==true,'dirty':row.IsDirty}"
                                            ng-repeat="row in VisibleRows|filter:SetRowVisibility"
                                            ng-include="GetTemplate(row)"></tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                    </div>
                </div>
            </div>
           
        </div>
    </form>
</div>
<script type="text/ng-template" id="display">
    <td ng-repeat="col in Columns">{{::row[col]}}</td>
</script>
